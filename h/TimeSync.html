<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<html lang="en">
<head>

<head>
 <title>Emerald Chronometer Time Synchronization</title>
 <meta name="viewport" content="width=device-width" />
 <link rel="apple-touch-icon" href="../images/eblogo57-1.png">
 <link rel="shortcut icon" href="../images/GlyphBerry.png" type="image/png">
 <meta http-equiv="Content-Type" content="text/html; charset=UTF-8" />
 <link rel="stylesheet" href="product.css"/>
</head>
<body>

<div display='inline' class='device'>
<div style="float:right"><p><a href="Help Contents.html" target="_top">Help Contents</a></div>
<br clear=all>
</div>
<div display='inline' class='website'>
<div class='floatL'>
 <a href="../index.html">Home</a>&nbsp;&nbsp;
 <a href="index.html">Chronometer</a>
</div>
<div class='floatR'>
 <a href="http://itunes.apple.com/us/app/emerald-chronometer/id284953670?mt=8">Buy Now</a>
</div>
<br>
<hr size=1>

<h1>Emerald Chronometer Time Synchronization</h1>

</div>



Emerald Chronometer uses a simplified version of
<a href="http://en.wikipedia.org/wiki/Network_Time_Protocol">Network Time Protocol (NTP)<img src="extlink.png"></a>
to synchronize its time displays with time servers on the Internet.
That's the short and simple version.  The longer, more technical, version
follows:
<p>
Every time Emerald Chronometer starts up and the "Use NTP" option is ON
or whenever that option is changed to ON, the app
goes out to NTP servers on the Internet and asks for the current
time. It chooses a pool of servers based on the user's country
setting: first from the local country's pool, then the continent pool
for that country, then the global pool, and finally time.apple.com.
This progression happens each time we get a new synchronization; there
are four sets of servers in each pool.  Emerald Chronometer compares
the time thus obtained with the time supplied by the iPhone, and
stores the difference as a "skew" value.  This skew is applied
globally throughout the application to every watch
<span class='Chronometer'>
display, with a couple of exceptions described further on.
</span>
<span class='GenevaOnly'>
display.
</span>
<p>
The size of this skew is completely dependent on how accurate the time
supplied by the telephone carrier's signal is.  In the SF Bay Area
where the authors live, it typically varies by up to a few seconds in
either direction.  In other areas it is reportedly larger.  The iPod
touch uses a different synchronization mechanism, synchronizing with
your desktop computer, so there it will depend on the accuracy of your
desktop computer.
<span display='inline' class='device'>
(You can see the current skew value by tapping on
the upper lift indicator light on the main screen.)
</span>
<p>
When you shut down and restart Emerald Chronometer, it will start with the same
skew value as it determined during the previous session, but it will
also go get a new skew value in case it has changed since the last
time the application was run.  If the skew has changed (or if this is the first
time the application has ever been run), then the hands showing the time will jump
to the new correct value.
<p>
When the iPhone gets a new cell-phone time (for example, when it
switches to a different tower), the iPhone OS changes its internal
time base used by all applications, and sends a notification to
running applications that the time has changed.  When Emerald Chronometer
gets this notification, it immediately changes the skew
value by the amount that the internal time base has apparently
shifted; it determines this shift by comparing against another internal
time base that does not change with cell-tower changes (CACurrentMediaTime).
Then it again goes out to the NTP servers to get the actual skew,
which is typically quite close to the "educated guess".  Occasionally,
especially in fringe-reception areas, you will see the time indicator
blink for a few seconds while it does this.
<p>
<div display='inline' class='Chronometer'>
A result of this approach, including the reliance on CACurrentMediaTime while
the device is unlocked, is that interval timing is continuously accurate
even across time changes due to cell-tower time shifts, again so long as the
device is unlocked.  If the device is locked after timing starts but before
the first synchronization is obtained, however, accuracy is lost because there
is no way of definitively calibrating the starting time.  The mechanism is
a bit complex, but the end result is that hands which display interval timing
will move smoothly through cell-tower time changes before and including the first
synchronization, unlike other time hands.  After synchronization, all
hands will continue to move smoothly.
<p>
<span class='Chronometer'>
When waking up after the screen has been locked, Emerald Chronometer resynchronizes with NTP, because to save power the iPhone's internal clocks are allowed to shut down while the screen is locked.  To maintain full NTP synchronization while the screen is locked, you can set an alarm on Istanbul or Thebes; if an alarm is pending, Emerald Chronometer keeps the internal clocks going so that the alarm can be sounded at the correct time.  The battery will drain about 50% faster if an alarm is pending.
<p>
</span>
</div>
<span class='Chronometer'>
<h2>Notifications</h2>
Emerald Chronometer does not maintain NTP synchronization when it is running in the background.   Therefore,
if the iPhone's time base changes while Emerald Chronometer is not running, then alarm notifications for Istanbul and Thebes may be offset from their requested time.  That can happen in a number of circumstances:
<ul>
 <li> The iPhone and the iPad 3G, if set to "Set time automatically", change their time base by a few seconds frequently when changing cell towers.
 <li>If those devices turn off "Set time automatically", and for all other devices, the time is subject to the accuracy of the device's internal clock, which can be off by several seconds per day or more.
</ul>
To minimize these small errors when relying on alarms, bring up Emerald Chronometer occasionally (long enough for the top-left light to become solid green); this will reset the time base used for alarms.
<p>
In addition, the OS does not guarantee that local notifications are delivered at the exact time specified; there may be a few-second delay if the device is busy with other activity.
</span>

<div display='inline' class='website'>
<br clear=all>
<br>
<hr size=1>
<h3>The Watches</h3>
<a href="Alexandria/Alexandria.html"><img src="Alexandria/Alexandria-icon-f.png" width=50 border=0  align=center vspece=4></a>
<a href="Atlantis/Atlantis.html"><img src="Atlantis/Atlantis-icon-f.png"   width=50 border=0 align=center vspece=4></a>
<a href="Chandra/Chandra.html"><img src="Chandra/Chandra-icon-f.png"    width=50 border=0 align=center vspece=4></a>
<a href="Haleakala/Haleakala.html"><img src="Haleakala/Haleakala-icon-f.png"  width=50 border=0 align=center vspece=4></a>
<a href=MaunaKea/MaunaKea.html><img src=MaunaKea/MaunaKea-icon-f.png  width=50 border=0 align=center vspece=4></a>
<a href="McAlester/McAlester.html"><img src="McAlester/McAlester-icon-f.png"  width=50 border=0 align=center vspece=4></a>
<a href="Paris/Paris.html"><img src="Paris/Paris-icon-f.png"      width=50 border=0 align=center vspece=4></a>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
<a href="Geneva/Geneva.html"><img src="Geneva/Geneva-icon-f.png"      width=50 border=0 align=center vspace=4></a>
<a href="Istanbul/Istanbul.html"><img src="Istanbul/Istanbul-icon-f.png"      width=50 border=0 align=center vspace=4></a>
<a href="Olympia/Olympia.html"><img src="Olympia/Olympia-icon-f.png"      width=50 border=0 align=center vspace=4></a>
<a href="Thebes/Thebes.html"><img src="Thebes/Thebes-icon-f.png"      width=50 border=0 align=center vspace=4></a>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
<a href="Firenze/Firenze.html"><img src="Firenze/Firenze-icon-f.png"      width=50 border=0 align=center vspace=4></a>
<a href="Miami/Miami.html"><img src="Miami/Miami-icon-f.png"      width=50 border=0 align=center vspace=4></a>
<a href="Vienna/Vienna.html"><img src="Vienna/Vienna-icon-f.png"      width=50 border=0 align=center vspace=4></a>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
<a href="Terra/Terra.html"><img src="Terra/Terra-icon-f.png"      width=50 border=0 align=center vspace=4></a>
<hr size=4>
Copyright&nbsp;&copy;&nbsp;2010, <a href="../index.html"><span class='emerald'>Emerald Sequoia LLC</span></a>; last&nbsp;updated:&nbsp;2010&nbsp;June&nbsp;11
</div>
<div display='inline' class='device'>
<hr>
<div style="font-size:8pt; text-align:center">
<div style="float:right"><p><a href="Help Contents.html" target="_top">Help Contents</a></div>
<iframe src="versionGen.html" scrolling="auto" width=100% height=30 frameborder=0>
<a href="versionGen.html">Version</a>
</iframe>
<a href="Credits.html">Copyright Information</a>
</div>
</div>
</body></html>
